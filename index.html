<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NachoZorra Generator</title>

<!-- Fuente felt tip -->
<link href="https://fonts.cdnfonts.com/css/felt-tip-roman" rel="stylesheet">
<!-- Fuente estilo brat -->
<link href="https://fonts.googleapis.com/css2?family=Arial+Narrow&display=swap" rel="stylesheet">

<style>
    :root {
        --felt: 'Felt Tip Roman', cursive;
        --brat-font: 'Arial Narrow', sans-serif;
        --brat-green: #8ACF00;
    }

    body {
        margin: 0;
        background: #111;
        color: #fff;
        font-family: var(--felt);
        overflow-x: hidden;
    }

    /* CONTROLES */
    .controls {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0,0,0,0.85);
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        backdrop-filter: blur(6px);
        z-index: 1000;
    }

    .mode-switch {
        display: flex;
        justify-content: center;
        gap: 15px;
    }

    button {
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        background: #ff7b00;
        color: #fff;
        cursor: pointer;
        font-family: var(--felt);
        font-size: 18px;
        font-weight: bold;
    }

    button.active {
        background: #ffc266;
        color: #000;
    }

    input[type="text"] {
        width: 100%;
        padding: 12px;
        border-radius: 12px;
        border: none;
        outline: none;
        font-size: 1.3em;
        text-align: center;
        font-family: var(--felt);
    }

    /* AREA PRINCIPAL */
    #stage {
        padding-bottom: 170px; 
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    /* NORMAL (CANVAS) */
    #normalBox {
        display: none;
    }

    #normalCanvas {
        width: 90vw;
        max-width: 540px;
        aspect-ratio: 1;
        border-radius: 40px;
        background: white;
        box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }

    /* BRAT MODE */
    #bratBox {
        display: none;
    }

    .brat-container {
        width: 90vw;
        max-width: 540px;
        aspect-ratio: 1;
        background: var(--brat-green);
        position: relative;
        overflow: hidden;
        padding: 40px;
    }

    /* Watermark gigante */
    .brat-watermark {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: var(--brat-font);
        font-size: 420px;
        opacity: 0.10;
        color: #000;
        white-space: nowrap;
        pointer-events: none;
        user-select: none;
        z-index: 1;
    }

    /* Texto principal estilo brat */
    .brat-text {
        position: relative;
        font-family: var(--brat-font);
        font-size: 140px;
        line-height: 0.85;
        color: black;
        text-align: justify;
        text-align-last: justify;
        filter: blur(2.5px);
        word-break: break-word;
        z-index: 10;
    }

</style>
</head>

<body>

<div id="stage">

    <!-- NORMAL MODE -->
    <div id="normalBox">
        <canvas id="normalCanvas" width="1080" height="1080"></canvas>
    </div>

    <!-- BRAT MODE -->
    <div id="bratBox">
        <div class="brat-container" id="bratContainer">
            <div class="brat-watermark">@nachozorra</div>
            <div class="brat-text" id="bratText">brat</div>
        </div>
    </div>

</div>

<!-- CONTROLES -->
<div class="controls">
    <input id="textInput" type="text" placeholder="Escribe tu frase..." />

    <div class="mode-switch">
        <button id="btnNormal">NORMAL</button>
        <button id="btnBrat">BRAT</button>
    </div>

    <button id="downloadBtn">⬇️ Descargar PNG</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
/* -------------------------------------------------------------
   ELEMENTOS
------------------------------------------------------------- */
const input = document.getElementById("textInput");
const btnNormal = document.getElementById("btnNormal");
const btnBrat = document.getElementById("btnBrat");

const normalBox = document.getElementById("normalBox");
const bratBox = document.getElementById("bratBox");

const bratText = document.getElementById("bratText");
const bratContainer = document.getElementById("bratContainer");

const normalCanvas = document.getElementById("normalCanvas");
const ctx = normalCanvas.getContext("2d");

/* -------------------------------------------------------------
   SWITCH DE MODO
------------------------------------------------------------- */
function activateNormal() {
    normalBox.style.display = "block";
    bratBox.style.display = "none";
    btnNormal.classList.add("active");
    btnBrat.classList.remove("active");
    drawNormal();
}

function activateBrat() {
    normalBox.style.display = "none";
    bratBox.style.display = "block";
    btnNormal.classList.remove("active");
    btnBrat.classList.add("active");
    drawBrat();
}

btnNormal.onclick = activateNormal;
btnBrat.onclick = activateBrat;

/* -------------------------------------------------------------
   ACTUALIZAR TEXTO
------------------------------------------------------------- */
input.addEventListener("input", () => {
    drawNormal();
    drawBrat();
});

/* -------------------------------------------------------------
   MODO NORMAL (CANVAS)
------------------------------------------------------------- */
function drawNormal() {
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, 1080, 1080);

    ctx.fillStyle = "#000";
    ctx.font = "70px 'Felt Tip Roman'";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(input.value, 540, 540);
}

/* -------------------------------------------------------------
   MODO BRAT (HTML + CSS)
------------------------------------------------------------- */
function drawBrat() {
    let txt = input.value.trim();
    if (txt.length === 0) txt = "brat";

    bratText.textContent = txt;

    // ESCALADO DINÁMICO DE FUENTE
    let base = 140;
    let long = txt.length;

    if (long > 20) base -= (long - 20) * 3;
    if (base < 60) base = 60;

    bratText.style.fontSize = base + "px";

    // BLUR dinámico
    let blur = 2 + Math.min(long / 20, 3);
    bratText.style.filter = `blur(${blur}px)`;
}

/* -------------------------------------------------------------
   DESCARGA PNG (html2canvas)
------------------------------------------------------------- */
document.getElementById("downloadBtn").onclick = async () => {
    let element = bratBox.style.display === "block"
        ? bratContainer
        : normalCanvas;

    const canvas = await html2canvas(element, {
        backgroundColor: null,
        scale: 1
    });

    const link = document.createElement("a");
    link.download = "nachozorra.png";
    link.href = canvas.toDataURL();
    link.click();
};

/* Inicio en modo NORMAL */
activateNormal();
</script>

</body>
</html>
