<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NachoZorra Generator ðŸ¦Š</title>

<!-- Felt Tip Roman (modo normal) -->
<link href="https://fonts.cdnfonts.com/css/felt-tip-roman" rel="stylesheet">

<!-- Arial Narrow (modo BRAT real) -->
<link href="https://fonts.cdnfonts.com/css/arial-narrow" rel="stylesheet">

<script src="https://cdn.tailwindcss.com"></script>

<style>
    :root {
        --controls-h: 110px;
        --felt: 'Felt Tip Roman', cursive;
        --brat: 'Arial Narrow', sans-serif;
    }

    body {
        background: #111;
        margin: 0;
        color: #fff;
        font-family: var(--felt);
        overflow: hidden;
    }

    /* Contenedor principal */
    #stage {
        height: calc(100vh - var(--controls-h));
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 0;
    }

    /* Canvas 1:1 */
    #previewCanvas {
        width: min(90vw, 90vh);
        height: min(90vw, 90vh);
        box-shadow: 0 8px 30px rgba(0,0,0,0.35);
        border-radius: 25px;
        background: #fff;
    }

    /* Controles */
    .control-panel {
        position: fixed;
        bottom: 0;
        width: 100%;
        height: var(--controls-h);
        background: rgba(0,0,0,0.85);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: 8px;
        z-index: 20;
        padding-bottom: 8px;
    }

    /* Switch tipo iPhone */
    .switch {
        position: relative;
        width: 55px;
        height: 28px;
    }
    .switch input { display:none; }
    .slider {
        position: absolute;
        cursor: pointer;
        top:0; left:0; right:0; bottom:0;
        background-color: #555;
        transition: .4s;
        border-radius: 34px;
    }
    .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 3px;
        bottom: 3px;
        background: white;
        transition: .4s;
        border-radius: 50%;
    }
    input:checked + .slider {
        background-color: #22c55e;
    }
    input:checked + .slider:before {
        transform: translateX(26px);
    }

</style>

</head>
<body>

<main id="stage">
    <canvas id="previewCanvas" width="1080" height="1080"></canvas>
</main>

<!-- Controles -->
<div class="control-panel">

    <!-- MODO: Normal / Brat -->
    <div class="flex items-center justify-center gap-3 text-sm">
        <span>Modo:</span>

        <label class="switch">
            <input type="checkbox" id="modeToggle">
            <span class="slider"></span>
        </label>

        <span id="modeLabel">Normal</span>
    </div>

    <!-- Input + fondo + botÃ³n -->
    <div class="flex items-center justify-center gap-3 w-full px-3">

        <input id="textInput"
               type="text"
               placeholder="Escribe tu frase..."
               class="flex-1 p-2 rounded-lg text-black text-center font-bold text-lg outline-none">

        <label class="text-sm">Fondo:</label>
        <input type="color" id="bgColor" value="#ffffff" class="w-8 h-8">

        <button id="downloadBtn"
                class="px-5 py-2 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700">
            Descargar PNG
        </button>
    </div>
</div>

<script>
/* ========= VARIABLES ========= */

const canvas = document.getElementById("previewCanvas");
const ctx = canvas.getContext("2d");

const input = document.getElementById("textInput");
const bgColorInput = document.getElementById("bgColor");
const toggle = document.getElementById("modeToggle");
const modeLabel = document.getElementById("modeLabel");

const CANVAS_SIZE = 1080;
const PADDING = 80;

/* ========= EVENTOS ========= */

input.addEventListener("input", draw);
bgColorInput.addEventListener("input", draw);
toggle.addEventListener("change", () => {
    modeLabel.textContent = toggle.checked ? "Brat" : "Normal";
    draw();
});
window.onload = draw;

/* ========= DIBUJAR ========= */

function draw() {
    const text = input.value.trim() || "";
    const bg = bgColorInput.value;

    // Fondo
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

    // Watermark suave
    drawWatermark();

    if (!toggle.checked) {
        drawNormal(text);
    } else {
        drawBrat(text);
    }
}

/* ========= MODO NORMAL ========= */

function drawNormal(text) {
    ctx.font = "80px var(--felt)";
    ctx.fillStyle = getContrastColor(bgColorInput.value);
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    wrapCenter(text, CANVAS_SIZE / 2);
}

/* ========= MODO BRAT REAL (Charli XCX) ========= */

function drawBrat(text) {
    ctx.textAlign = "left";
    ctx.textBaseline = "top";

    ctx.fillStyle = "#000";
    ctx.font = "140px var(--brat)";

    const lines = justifyText(text, CANVAS_SIZE - PADDING * 2);

    let y = PADDING;

    lines.forEach((line, i) => {
        ctx.save();

        // Blur tipo brat
        ctx.filter = "blur(3px)";

        // Dibujar lÃ­nea
        ctx.fillText(line, PADDING, y);

        ctx.restore();

        y += 150; // separaciÃ³n entre lÃ­neas brat
    });
}

/* ========= GENERAR JUSTIFICADO ========= */

function justifyText(text, maxWidth) {
    const words = text.split(" ");
    let line = "";
    const lines = [];

    ctx.font = "140px var(--brat)";

    for (let w of words) {
        const test = line + w + " ";
        if (ctx.measureText(test).width > maxWidth) {
            lines.push(justifyLine(line.trim(), maxWidth));
            line = w + " ";
        } else {
            line = test;
        }
    }
    lines.push(line.trim());
    return lines;
}

function justifyLine(line, width) {
    const words = line.split(" ");
    if (words.length < 2) return line;

    const noSpaceWidth = words.reduce((a,w)=>a+ctx.measureText(w).width,0);
    const totalSpaces = words.length - 1;
    const spaceSize = (width - noSpaceWidth) / totalSpaces;

    return words.join(" ".repeat(Math.max(1, Math.floor(spaceSize / 20))));
}

/* ========= WATERMARK ========= */

function drawWatermark() {
    ctx.save();
    ctx.globalAlpha = 0.08;
    ctx.fillStyle = "#000";
    ctx.font = "250px var(--brat)";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    ctx.fillText("@nachozorra", CANVAS_SIZE / 2, CANVAS_SIZE / 2);
    ctx.restore();
}

/* ========= UTILIDADES ========= */

function wrapCenter(text, centerY) {
    const words = text.split(" ");
    let lines = [];
    let current = "";

    ctx.font = "80px var(--felt)";
    const maxWidth = CANVAS_SIZE - PADDING * 2;

    words.forEach(w => {
        const test = current + w + " ";
        if (ctx.measureText(test).width > maxWidth) {
            lines.push(current.trim());
            current = w + " ";
        } else {
            current = test;
        }
    });
    lines.push(current.trim());

    const totalHeight = lines.length * 100;
    let y = centerY - totalHeight / 2;

    lines.forEach(l => {
        ctx.fillText(l, CANVAS_SIZE / 2, y);
        y += 100;
    });
}

function getContrastColor(hex) {
    hex = hex.replace("#","");
    const r=parseInt(hex.substr(0,2),16);
    const g=parseInt(hex.substr(2,2),16);
    const b=parseInt(hex.substr(4,2),16);
    const brightness=(r*299+g*587+b*114)/1000;
    return brightness>150?"#000":"#fff";
}

/* ========= DESCARGAR PNG ========= */

document.getElementById("downloadBtn").addEventListener("click", () => {
    const link = document.createElement("a");
    link.download = "nachozorra.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
});
</script>

</body>
</html>
